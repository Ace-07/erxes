---
id: ubuntu-step-by-step
title: CE Step by Step Installation
---

## Installing the Community Edition

The following instructions take you through **step by step** and have you install **erxes** on a brand new **Ubuntu 18.04** server.

:::info
These instructions assume a minimum of **4 CPUs or more** and **8GB RAM or more** on your server.
:::

This guide shows each step to install the depencies necessary to run **erxes**. Developers can follow these steps for a new server installation or to understand installing **erxes** on an existing server.

The following installation steps work on **Ubuntu 18.04** servers as hosted by companies like [Digital Ocean](https://digitalocean.com), [Linode](https://linode.com) and [Vultr](https://vultr.com). The instructions do **not** work on **_Amazon EC2 instances_**.

For most developers, the [Quick Start Installation](ubuntu-quickstart) is better.

:::note Upgrading from a Minimum Server
These steps are **not** the correct steps to _upgrade an existing installation_ to a **Recommended** Server installation with more memory and CPU power. Please follow instructions here in how to [Upgrade from a Minimum Server](upgrade-minimal-server).

:::

## Setting up a server with Ubuntu 18.04

You must have an account with your hosting provider prior to doing these steps.

Create an instance of a server running **Ubuntu 18.04**. (You should have the ability to to **SSH** into the server.)

You will need to point your domain or subdomain name to your new server. You can read a guide on how to configure your domain [here](ubuntu-quickstart#configure-your-dns-records-to-point-at-your-server).

- Choose a server with the starting **Recommended server** requirements:
  - **4 CPUs or more**
  - **8GB RAM or more**

After setting up your server, continue with the instructions below.

## Log into server as root and create erxes user

Open the terminal or command prompt on your computer. You will need your **IP address**. (In this example, **44.123.32.12**). Type `yes`, when asked if you want to continue connecting.

```bash
# example ssh root@44.123.32.12
ssh root@your-ip-address
```

(**Note**: Some people get an error, **WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!**, please see the solution [here](/installation/ubuntu-troubleshooting).)

You don't want to use the **root** user to administer your server. So everything will be done by a user called, **erxes**. To accomplish this, run the following commands:

Add a user called "erxes". When prompted, enter in a **unique** password. You will need to keep this password available, as later operations will require using it.

```bash
adduser erxes
```

(Finish adding the user simply by pressing the `enter` or `return` key through the questions.)

Grant the **erxes** user adminstrative rights.

```bash
usermod -aG sudo erxes
```

Your next step, still as **root** user, is to set-up a basic firewall for your server.

## Set-up a basic firewall for SSH, nginx 80 and port 443

### Basic Firewall - Port 22

Allow OpenSSH with **ufw**. OpenSSH will use **port 22**.

```bash
ufw allow OpenSSH
```

Enable **ufw**

```bash
ufw enable
```

- Type `y` when asked, "**Command may disrupt existing ssh connections. Proceed with operation (y|n)?**"

Check the **ufw** status

```bash
ufw status
```

You should have an output like below:

```bash
Status: active

To                         Action      From
--                         ------      ----
OpenSSH                    ALLOW       Anywhere
OpenSSH (v6)               ALLOW       Anywhere (v6)
```

### HTTP & HTTPS - Port 80 & Port 443

Allow **HTTP** (port 80) and **HTTPS** (port 443) with **ufw**

```bash
ufw allow proto tcp from any to any port 80,443
```

Check the ufw status

```bash
ufw status
```

You should have an output like below:

```bash
Status: active

To                         Action      From
--                         ------      ----
OpenSSH                    ALLOW       Anywhere
80,443/tcp                 ALLOW       Anywhere
OpenSSH (v6)               ALLOW       Anywhere (v6)
80,443/tcp (v6)            ALLOW       Anywhere (v6)
```

## Allow the "erxes" user to **SSH** into server

open the `sshd_config` file to edit

```bash
nano /etc/ssh/ssh_config
```

- Scroll down until you see `PasswordAuthentication`. Change it from `PasswordAuthentication no` to `PasswordAuthentication yes`. **NOTE**: Some servers have this line commented out with a `#`, like `# PasswordAuthentication no`. You will need to uncomment it by deleting the `#`.

- The line should look like this:

```bash
PasswordAuthentication yes
```

- Save and exit with `ctrl + x` and then `y` to accept the changes.

Reload the SSH config file

```bash
sudo service sshd reload
```

Exit from server, so that you can log back in as the **erxes** user

```bash
exit
```

You have created a new user called, **erxes** and you set-up a basic firewall to protect your server against malicious attacks.

Please continue with the following steps to log in to your server as the **erxes** user.

## Log in to your server as the "erxes" user.

Before you can log into your new server, we need to **add the SSH key** to your **local** computer.

**NOTE:** You need to use the **IP address** of your server.

- Run the following command and **create a new password**.

```bash
#ssh-copy-id erxes@44.123.32.12 <--- This is an example. Use your ip address
ssh-copy-id erxes@your-IP-address
```

Now you can log into your server as the **erxes** user.

- Log back into the server as the **erxes** user. You will need your IP address. (In this example, **44.123.32.12**). Enter your previously created password, if prompted.

```bash
# example ssh erxes@44.123.32.12 <--- This is an example. Use your ip address
ssh erxes@your-ip-address
```

In the following sections, you will install software dependencies that are needed to run **erxes**.

## Nvm install

**Node Version Manage (nvm)** is a tool that allows you to download and install [Node.js](https://nodejs.org/). You can read more about the installation process here: [How to install NVM](https://gist.github.com/d2s/372b5943bce17b964a79)

Install **nvm** and initialize by reloading the shell configuration. (Run the following commands separately.)

```bash
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh | bash
source ~/.bashrc
```

Verify **nvm** is installed by running:

```bash
nvm --version
```

You should get a similar output as below:

```bash
0.35.3
# your version of nvm may be different
```

You are ready to continue with installing **Node.js**.

## Install Node.js with nvm

You can read more about installing **Node.js** with **nvm** here: [How to install Node.js with NVM](https://gist.github.com/d2s/372b5943bce17b964a79#install-nodejs-with-nvm)

Install **Node.js**

```bash
nvm install 12
```

Check to see if **Node.js** is installed correctly.

```bash
node -v
```

You should get a similar output as below:

```bash
v12.20.0
# your version of node.js may be different
```

With **Node.js** installed, you can continue with installing **Yarn**.

## Yarn install

**Yarn** is a package manager. The alternative is [npm](https://www.npmjs.com/). We recommend [yarn](https://yarnpkg.com/). For additional [yarn installation instructions, read this](https://classic.yarnpkg.com/en/docs/install/#debian-stable).

Install **yarn**. (Run the following commands separately.)

```bash
curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
sudo apt update && sudo apt install --no-install-recommends yarn
```

Check to see if **yarn** is installed correctly

```bash
yarn --version
```

You should get a similar output as below:

```bash
1.22.5
# your version of yarn may be different
```

As long as you received a version response to `yarn --version`, then you can continue and install **MongoDB**.

## Install MongoDB

**MongoDB** is a robust and general purpose document-based database. For additional [MongoDB installation instructions, read this](https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/).

Erxes supports MongoDB version 3.6+ is supported. Previous versions are not supported.

Install **MongoDB**. (Run the following commands separately.)

```bash
wget -qO - https://www.mongodb.org/static/pgp/server-4.2.asc | sudo apt-key add -
echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.2 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.2.list
sudo apt-get update
sudo apt-get install -y mongodb-org
```

Start and enable **MongoDB**. (Run the following commands separately.)

```bash
sudo systemctl start mongod
sudo systemctl enable mongod

#Created symlink /etc/systemd/system/multi-user.target.wants/mongod.service → /lib/systemd/system/mongod.service.
```

- Check to see if **MongoDB** is installed correctly

```bash
mongod --version
```

As long as you received a version response to `mongod --version`, then you can continue below.

### Deploy a MongoDB Replica Set

MongoDB [replica sets](https://docs.mongodb.com/manual/reference/glossary/#term-replica-set) add an extra layer of redundancy and help with load balancing. They are a group of **mongod processes** that maintain matching data sets. You can read about **replication** [here](https://docs.mongodb.com/manual/replication/).

Stop the **mongod** processes

```bash
sudo systemctl stop mongod
```

Open **mongod.conf**

```bash
sudo nano /etc/mongod.conf
```

Enable the **replicaset** settings, by searching for `#replication`. Remove the `#` to activate it and edit to include the set name, as follows:

```bash
replication:
  replSetName: "rs0"
```

- Save and Exit with `ctrl + x` and then `y` to accept the changes.

Restart mongob

```bash
sudo systemctl start mongod
```

Connect to mongo shell

```bash
mongo
```

Initialize replicaSet

```bash
rs.initiate()
```

- You should have an output similar to below. Verify **SECONDARY** changes to **Primary** by pressing enter several times.

```bash
{
	"info2" : "no configuration specified. Using a default configuration for the set",
	"me" : "127.0.0.1:27017",
	"ok" : 1,
	"$clusterTime" : {
		"clusterTime" : Timestamp(1594140533, 1),
		"signature" : {
			"hash" : BinData(0,"AAAAAAAAAAAAAAAAAAAAAAAAAAA="),
			"keyId" : NumberLong(0)
		}
	},
	"operationTime" : Timestamp(1594140533, 1)
}

rs0:SECONDARY>
rs0:PRIMARY> # <----- This is what you are looking for
```

- press `ctrl-c` to quit mongo

```bash
rs0:PRIMARY>
bye
```

## Set-up Mongo User and Password for MongoDB and export MongoDB URL

We need to create a user and password for the MongoDb database.

Initialize **MongoDb** and generate **login password**. (Execute each line separately.)

```bash
MONGO_PASS=$(openssl rand -hex 16)
echo $MONGO_PASS
# You should receive output similar to:
# c20fb93b2772598ab483f2fde64292f6
```

Set `mongod` password and create user in Mongo to set-up security parameters. (Execute as one command.)

```bash
mongo --eval "db=db.getSiblingDB('admin'); \
db.createUser({ user: 'erxes', pwd: \"$MONGO_PASS\", roles: [ 'root' ] })"

```

Verify the MongoDb password set above is correct.

```bash
MONGO_URL="mongodb://erxes:$MONGO_PASS@localhost/erxes?authSource=admin\&replicaSet=rs0"
echo $MONGO_URL
# Output is similar to
# mongodb://erxes:c20fb93b2772598ab483f2fde64292f6@localhost/erxes?authSource=admin\&replicaSet=rs0

```

If you get an output similar to the above example, you may continue with installing and configuring NGINX.

## Install and configure NGINX

**NGINX** is a very powerful web server. It is often used as a proxy server for emails. For additional [NGINX installation instructions, read this](https://www.nginx.com/resources/wiki/start/topics/tutorials/install/).

NGINX is installed from the stable repo https://launchpad.net/~nginx/+archive/ubuntu/stable.

Add the **PPA** for **NGINX**. Press `enter` when prompted to continue.

```bash
sudo add-apt-repository ppa:nginx/stable

# Output should be similar to
# This PPA contains the latest Stable Release version of the nginx web server software.

# **Only Non-End-of-Life Ubuntu Releases are supported in this PPA**

# **Development releases of Ubuntu are not officially supported by this PPA, and uploads for those will not be available until actual final releases for those versions**
 # More info: https://launchpad.net/~nginx/+archive/ubuntu/stable

Press [ENTER] to continue or Ctrl-c to cancel adding it.

```

- **Press Enter** to continue with the installation.

Install **NGINX** with the following commands.

```bash
sudo apt-get update
sudo apt-get install -y nginx
```

**NGINX** started by default when you installed it. But it is recommended to `enable` and `start` anyway.

Enable and start **NGINX**

```bash
sudo systemctl enable nginx
sudo systemctl start nginx
```

### Configure NGINX

The next step is to configure **NGINX** so that it allows traffic through `Ports 80 and 443`.

Ensure the `ufw` firewall knows about the available applications.

```bash
sudo ufw app list
```

You are expecting the following output:

```bash
Available applications:
  Nginx Full
  Nginx HTTP
  Nginx HTTPS
  OpenSSH
```

The output should look something like the `Available applications` output above. `Nginx Full` should be listed.

Enable Port 80 and Port 443 to allow traffic.

```bash
sudo ufw allow 'Nginx Full'
```

Verify that `ufw` has been updated.

```bash
sudo ufw status
```

You are expecting the following output.

```bash
Status: active

To                         Action      From
--                         ------      ----
OpenSSH                    ALLOW       Anywhere
80,443/tcp                 ALLOW       Anywhere
Nginx Full                 ALLOW       Anywhere
OpenSSH (v6)               ALLOW       Anywhere (v6)
80,443/tcp (v6)            ALLOW       Anywhere (v6)
Nginx Full (v6)            ALLOW       Anywhere (v6)
```

- Open the **nginx.conf**

```bash
sudo nano /etc/nginx/nginx.conf
```

- Uncomment the following line `server_names_hash_bucket_size 64;`

It should look like this:

```txt
http {
    * * *

    server_names_hash_bucket_size 64;

    * * *
}
```

- Save with `ctrl + x` and then `y` to accept the changes.

After saving the file above, you may continue to installing **Certbot**.

## Install Certbot

**Let's Encrypt** enables you to use **HTTPS** on your website. It will issue you a certificate which shows that you control your domain. [Let's Encrypt additional information](https://www.nginx.com/resources/wiki/start/topics/tutorials/install/).

You will follow the installation instructions as covered [here](https://certbot.eff.org/lets-encrypt/ubuntubionic-nginx), with [Certbot](https://certbot.eff.org/).

**NOTE:** You are simply installing **Certbot** in these steps, not running or configuring **Certbot**. The **erxes** installation script will execute **Certbot** for the provided domain.

- You will need to add a **Certbot** PPA to the list of repositories on the server. (Run the following commands separately.)

```bash
sudo apt-get update
sudo apt-get -y install software-properties-common
sudo add-apt-repository universe
sudo add-apt-repository -y ppa:certbot/certbot
sudo apt-get update
```

- Install Certbot

```bash
sudo apt-get install -y certbot python3-certbot-nginx
```

You have now installed **Certbot**. You may continue with installing **PM2** below.

## Install PM2

**PM2** is a tool that helps you manage and keep **erxes** online. It is a process manager. You can read more about the installation process here: [How to install PM2](https://pm2.keymetrics.io/docs/usage/quick-start/)

- Install **PM2**

```bash
npm install pm2@latest -g
```

- Check to see if **PM2** is installed correctly.

```bash
pm2 --version
```

You should get a similar output as below:

```bash
4.5.0
# your version of pm2 may be different
```

You should receive a response from `pm2 --version`. The version should show as last line. You will need **PM2** later in the installation process.

You have now installed all the dependencies that **erxes** depends on. Continue on with the next steps to install **erxes**.

## Install erxes

All the dependencies for **erxes** are now installed.

Execute the following changing _my-project_ to any project name that you would like. This will be the name of the folder where **erxes** is installed.

```bash
yarn create erxes-app my-project --mongoUrl=$MONGO_URL
```

Please enter the exact domain or subdomain name **erxes** will use. For example, `example.com` or `erxes.example.com`.

```bash
#Please enter your domain (localhost):
Please enter your domain (localhost): erxes.example.com
```

### RabbitMQ and Redis

You will now be asked about using [RabbitMQ](https://www.rabbitmq.com/) and [Redis](https://redis.io/). Type `yes`, if you would like either or both of **RabbitMQ** and **Redis** . Otherwise, type `no` or press `enter`.

(These options are for high traffic installations. If unsure, type `no`, and you will be able to accept them later at any time.)

**RabbitMQ:**

```bash
#Are you using rabbitmq then enter rabbitmq host (optional):
Are you using rabbitmq then enter rabbitmq host (optional): no
```

**Redis:**

```bash
#Are you using redis then enter redis host (optional):
Are you using redis then enter redis host (optional): no
```

### Elasticsearch

[Elasticsearch](https://www.elastic.co/) is used to perform the search functions in **erxes**. You will be given a choice of three options:

- You can host **Elasticsearch** on your server (http://localhost:9200) **(Recommended)**,
- Use the free erxes **Elasticsearch** hosted version, or
- Host **Elasticsearch** on it's own server (for high traffic installations).

_The recommended option is hosting your own **Elasticsearch**._

Navigate using the **Up Arrow &#8593;** and **Down Arrow &#8595;** keys to select the option and then press **Enter** to select.

```bash
? Elasticsearch url ? (Use arrow keys)
❯ http://localhost:9200 (on local)
  https://elasticsearch.erxes.io (limited erxes.io offering)
  enter your elasticsearch url
```

### Connecting Elasticsearch to MongoDb

This is an **Advanced Option**. It is possible to create unique processes to sync **Elasticsearch** with **MongoDB**. Unless you know what you're doing, select the first option, _Using mongo change stream_ by pressing **Enter**.

```bash
? How do you want to sync mongo to elasticsearch ? (Use arrow keys)
❯ Using mongo change stream
  Using seperate process written in python which requires more specs and more dependencies
```

When **erxes** has successfully been installed, you may continue and copy the `NGINX Config file`.

### Start erxes and running processes

You will now finish the installation steps for **erxes**. And then you will take a new `nginx.conf` file (configured for your domain and other settings) and copy this new file and to replace the existing one.

```bash
cd my-project
yarn start
```

Yarn will automatically finished the installation process. You should see the following success message in your terminal.

```bashrc
 __        __   _                            _          _____
 \ \      / /__| | ___ ___  _ __ ___   ___  | |_ ___   | ____|_ ____  _____  ___
  \ \ /\ / / _ \ |/ __/ _ \| '_ ` _ \ / _ \ | __/ _ \  |  _| | '__\ \/ / _ \/ __|
   \ V  V /  __/ | (_| (_) | | | | | |  __/ | || (_) | | |___| |   >  <  __/\__ \
    \_/\_/ \___|_|\___\___/|_| |_| |_|\___|  \__\___/  |_____|_|  /_/\_\___||___/
```

Next, verify all processes are correctly running, but executing the `pm2 list` command.

```bash
pm2 list
```

The output should match the following:

```bashrc
# expected output:
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ api                │ fork     │ 0    │ online    │ 0%       │ 100.3mb  │
│ 1  │ cronjobs           │ fork     │ 0    │ online    │ 0%       │ 94.9mb   │
│ 6  │ email-verifier     │ fork     │ 11   │ online    │ 0%       │ 88.1mb   │
│ 4  │ engages            │ fork     │ 0    │ online    │ 0%       │ 59.7mb   │
│ 3  │ integrations       │ fork     │ 0    │ online    │ 0%       │ 90.2mb   │
│ 5  │ logger             │ fork     │ 0    │ online    │ 0%       │ 56.8mb   │
│ 7  │ ui                 │ fork     │ 0    │ online    │ 0%       │ 37.8mb   │
│ 8  │ widgets            │ fork     │ 0    │ online    │ 0%       │ 42.8mb   │
│ 2  │ workers            │ fork     │ 0    │ online    │ 0%       │ 94.6mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
```

### Copy NGINX Config files

Execute the following commands to copy the properly configured `nginx.conf` files and ensure your domain can receive traffic on this server.

```bash
## nginx.conf
sudo cp nginx.conf /etc/nginx/sites-available/default
```

Test the **NGINX** configuration to make sure you don't have any errors

```bash
sudo nginx -t
```

You should see the following output:

```bash
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
```

If you got no errors, reload nginx service.

```bash
sudo systemctl reload nginx
```

## Execute and configure Certbot

Execute the previously installed Certbot.

```bash
sudo certbot --nginx
```

You will asked several questions, you can answer as follows:

- Enter your email address
- Agree with the **Terms of Service**
- Answer `Yes` or `No`, if you want to share your email address with the Electronic Frontier Foundation
- Select the corresponding number associated with your domain name, usually `1`
- Choose `2` to redirect all your traffic to a secure **HTTPS**

Now run the following to **test and set-up** automatic renewal of your 90 day certbot. This needs to succeed so that your renewals are automatic.

```bash
sudo certbot renew --dry-run
```

Check your website in the browser. You should see the **Secure Padlock** next to your URL. You are now ready to create a new user and log in.

## Congratulations, time to log in

You have installed **erxes**. You may now visit your url and complete the **Initial Configuration Steps**.

We recommend opting-in to the newsletter and email update notifications to receive immediate notifications of important updates, instructions, and new tutorials.
